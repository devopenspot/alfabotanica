---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import WhatsAppButton from '../components/WhatsAppButton.astro';
import oleatoImage from '../assets/img/oleato.png';
import rosemaryImage from '../assets/img/tonico-capilar.png';
import chamomileImage from '../assets/img/tonico-facial.png';
import creamImage from '../assets/img/crema.png';
import solarScreenImage from '../assets/img/protector-solar.png';
import ortigaImage from '../assets/img/elixir.png';

const productImages = {
  'img/oleato.png': oleatoImage,
  'img/tonico-capilar.png': rosemaryImage,
  'img/tonico-facial.png': chamomileImage,
  'img/crema.png': creamImage,
  'img/protector-solar.png': solarScreenImage,
  'img/elixir.png': ortigaImage
};

type Props = CollectionEntry<'products'>['data'];

const { id, name, description, image, price, ...rest } = Astro.props;
const title = name;
const heroImage = productImages[image as keyof typeof productImages];
---

<html lang="en">
	<head>
		<BaseHead title={title} description={description} />
		<script type="application/ld+json" set:html={JSON.stringify({
			"@context": "https://schema.org",
			"@type": "Product",
			"name": name,
			"description": description,
			"image": heroImage ? new URL(heroImage.src, Astro.site).toString() : "",
			"offers": {
				"@type": "Offer",
				"price": price,
				"priceCurrency": "USD"
			}
		})} />
	</head>

	<body>
		<Header />
		<main transition:persist="main-content" class="">
			<div class="p-4 text-center">
				<a href="/#shop" class="text-[rgb(var(--gray))] no-underline hover:underline">&larr; Volver a la tienda</a>
			</div>
			<article>
				<div class="max-w-[800px] mx-auto w-full">
					{heroImage && <Image width={800} height={400} src={heroImage} alt={title} loading="lazy" format="webp" sizes="100vw" densities={[0.5, 1, 2]} class="block max-w-full h-auto rounded-xl shadow-[var(--box-shadow)]" />}
				</div>
				<div class="prose w-[720px] max-w-[calc(100%-2em)] mx-auto p-4 text-[rgb(var(--gray-dark))]">
					<div class="title mb-4 py-4 text-center leading-none">
						<h1 class="m-0 mb-2">{title}</h1>
						<hr />
					</div>
					{price && (
						<div class="price-section text-center mb-4">
							<p class="price text-xl font-bold text-[rgb(var(--gray-dark))]">${price}</p>
						</div>
					)}
					<div class="whatsapp-section mb-4">
						<WhatsAppButton productName={name} sku={id.toString()} />
					</div>
					<slot />
				</div>
			</article>
			<!-- <section class="related-products mt-8 p-4 mx-auto">
				<h2>Productos Relacionadoss</h2>
				<p>Próximamente: otros productos de la colección.</p>
			</section> -->
		</main>
		<Footer />
	</body>
</html>
